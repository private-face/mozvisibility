/*
 * mozVisibility.js library v0.6
 * Page Visibility API emulation for Firefox 5+
 * 
 * Copyright (c) 2012 Vladimir Zhuravlev
 * 
 * Released under MIT License
 * 
 * Date: Sun Jan 15 20:26:37 GST 2012
 **/(function(){MozVisibility={_MAX_TRIES:10,_date:new Date,_tries:0,_timer:null,_isVisible:undefined,_proxy:function(a,b){b=b||window;return function(){a.apply(b,arguments)}},_getEvent:function(){this._event||(this._event=document.createEvent("HTMLEvents"),this._event.initEvent("mozvisibilitychange",!0,!0),this._event.eventName="mozvisibilitychange");return this._event},_setVisibilityState:function(a){this._isVisible=a==="visible",document.mozVisibilityState=a,document.mozHidden=!this._isVisible,document.dispatchEvent(this._getEvent())},_visibilityCheck:function(){this._date=new Date,this._tries=0,this._timer=setTimeout(this._invisibilityCheckTimeout,0)},_invisibilityCheckTimeoutTemplate:function(){var a=new Date,b=a-this._date;this._date=a,this._tries++,b>1e3?this._setVisibilityState("hidden"):this._tries<this._MAX_TRIES&&(this._timer=setTimeout(this._invisibilityCheckTimeout,0))},_onFocus:function(){clearTimeout(this._timer),this._isVisible||this._setVisibilityState("visible")},_onBlur:function(){!this._isVisible||this._visibilityCheck()},canBeEmulated:function(){var a=/(mozilla)(?:.*? rv:([\w.]+))?/,b=navigator.userAgent.toLowerCase(),c=b.indexOf("compatible")<0&&a.exec(b)||[];return window.top===window&&c[2]&&parseInt(c[2])>=5&&!document.visibilityState&&!document.MozVisibilityState},emulate:function(){if(!this.canBeEmulated())return!1;this._invisibilityCheckTimeout=this._proxy(this._invisibilityCheckTimeoutTemplate,this),window.addEventListener("focus",this._proxy(this._onFocus,this),!1),window.addEventListener("blur",this._proxy(this._onBlur,this),!1),this._visibilityCheck();return!0}},MozVisibility.emulate()})()